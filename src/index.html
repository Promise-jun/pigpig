<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pigpig</title>
    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <!-- 引入index.css -->
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body role="document" ng-app="health">
      <ui-view></ui-view>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./js/jquery-1.11.3.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/angular.js"></script>
    <script type="text/javascript" src="./js/angular-ui-router.js"></script>
    <script type="text/javascript">
      var healthApp=angular.module('health',['ui.router'])
      .config(function($stateProvider,$urlRouterProvider,$urlMatcherFactoryProvider){
          $urlRouterProvider.otherwise('/navbar/home'); //默认页
          $urlMatcherFactoryProvider.caseInsensitive(true); //忽略大小写(不敏感匹配)
          $stateProvider
          .state("navbar",{ //公共父页
            url:'/navbar',
            templateUrl:'./template/navbar.html',
            controller:'navbarController'
          })
          .state("navbar.home",{ //主页
            url:'/home',
            templateUrl:'./template/home.html',
            controller:'homeController'
          })
          .state("navbar.issueList",{ //问题列表页
            url:'/issueList/:id/:page',
            templateUrl:'./template/issueList.html',
            controller:'issueListController'
          })
          .state("navbar.issueDetail",{ //问题详情页
            url:'/issueDetail/:id',
            templateUrl:'./template/issueDetail.html',
            controller:'issueDetailController'
          })
      })
      //公共父页控制器
      .controller('navbarController',function($scope,$http){ 
          $http({
            url:'http://localhost/issue-assort.php',
            method:'get'
          }).then(function(res){
            $scope.issueCategories=res.data.tngou;
          })
      })
      //主页控制器
      .controller('homeController',function($scope){ 
         
      })
      //问题列表页控制器
      .controller('issueListController',function($scope,$http,$stateParams){ 
          $http({
            url:'http://localhost/issue-list.php',
            method:'get',
            params:{
              id:$stateParams.id,
              page:$stateParams.page
            }
          }).then(function(res){
            $scope.issueList=res.data.tngou;
            console.log($scope.issueList)
            
            var pageCountList=[]; //创建数组保存页码
            var rows=12;          //每页显示的个数
            var sumPage=Math.ceil(res.data.total/rows); //求出总的页数
            for(var i=1; i<=sumPage; i++){
              pageCountList.push(i);
            }
            $scope.id=$stateParams.id;
            $scope.pageCountList=pageCountList;

            $scope.begin=0;
            //showPageAdd--->点击向上滚动页码
            $scope.showPageAdd=function(begin){
              if ($scope.begin>=sumPage-10) {
                return false;
              }
              $scope.begin++; 
            }
            //showPageDown--->点击向下滚动页码
            $scope.showPageDown=function(begin){
              if ($scope.begin<=0) {
                return false;
              }
              $scope.begin--;
            }
          })
      })
      //问题详情页控制器
      .controller('issueDetailController',function($scope,$http,$stateParams){ 
         $http({
            url:'http://localhost/issue-detail.php',
            method:'get',
            params:{
              id:$stateParams.id
            }
         }).then(function(res){
            $scope.issueDetails=res.data;
         })
      })
    </script>
  </body>
</html>

