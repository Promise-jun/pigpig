<!DOCTYPE html>
<html>
<head>
	
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>weather</title>
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
    <style type="text/css">
    	ul li{
    		list-style: none;
    	}
    	.row{
    		margin-top: 150px;
    	} 
    </style>
    
</head>
<body ng-app="health">
<ui-view></ui-view> 
	


	<!-- <script src="./js/jquery-1.11.3.js"></script>  -->
	<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
	<script src="./js/bootstrap.min.js"></script> 
	 <script type="text/javascript" src="./js/angular.js"></script> 
	<script type="text/javascript" src="./js/angular-ui-router.js"></script> 
	<script type="text/javascript">

		var healthApp=angular.module("health",['ui.router'])

		.run(function($rootScope, $state, $stateParams) {
          
  			
            $rootScope.$state = $state; //stateÊÇÎÒÃÇµÄ×´Ì¬£¬·Åµ½ÁË$rootScope
            $rootScope.$stateParams = $stateParams; // stateParamsÊÇÎÒÃÇµÄÂ·ÓÉµÄ²ÎÊý
            // stateChangeSuccess
            $rootScope.$on("$stateChangeSuccess", function(event, toState, toParams, fromState, fromParams) {
                // to be used for back button //won't work when page is reloaded.
                $rootScope.previousState_name = fromState.name; //¼ÇÂ¼Ç°Ò»¸öÂ·ÓÉµÄÃû³Æ
                $rootScope.previousState_params = fromParams; //¼ÇÂ¼Ç°Ò»¸öÂ·ÓÉµÄ²ÎÊý
            });
            //back button function called from back button's ng-click="back()"
            $rootScope.back = function(obj) {
                //Èç¹ûÇ°Ò»¸öÂ·ÓÉµÄÃû³Æ³¤¶ÈÎª0£¬¾ÍÒâÎ¶×ÅÃ»ÓÐÇ°Ò»¸öÂ·ÓÉ²Ù×÷£¬ÎÒÃÇ¾ÍÃ»ÓÐ·µ»ØµÄÂ·¾¶
                if ($rootScope.previousState_name.trim().length != 0) {
                    $state.go($rootScope.previousState_name, $rootScope.previousState_params);

                } else {
                    // alert('Ã»ÓÐ¿É·µ»ØµÄÒ³Ãæ!');
                    $('#' + obj).popover('show');

                }
            };
        })
  		.directive("compile", function($compile) {
            return function(scope, element, attrs) {
                scope.$watch(
                    function(scope) {
                        return scope.$eval(attrs.compile);
                    },
                    function(value) {
                        element.html(value);
                        $compile(element.contents())(scope);
                    }
                )
            }
        })
        .filter('range', function() {
            return function(input, total) {
                total = parseInt(total);
                for (var i = 1; i <= total; i++) {
                    input.push(i);
                }
                return input;
            };
        })
	 	.filter('trustHtml', function ($sce) {
	        return function (input) {
	            return $sce.trustAsHtml(input);
	        }
	    })



		.config(function($stateProvider,$urlRouterProvider,$urlMatcherFactoryProvider){
			$urlRouterProvider.otherwise('/navbar');
			$urlMatcherFactoryProvider.caseInsensitive(true);
    		$stateProvider
    		.state('navbar',{
    			url:'/navbar',
    			templateUrl:'./template/navbar.html',
    			controller:'navbarController'
    		})
    		.state('navbar.home',{
    			url:'/home',
    			templateUrl:'./template/home.html',
    			controller:'homeController'
    		})
    		.state('navbar.consurtList',{
    			url:'/consurtList/:id/:page',
    			templateUrl:'./template/consurtList.html',
    			controller:'consurtListController'
    		})
    		.state('navbar.healthDetail',{
    			url:'/healthDetail/:id',
    			templateUrl:'./template/healthDetail.html',
    			controller:'healthDetailController'
    		})
		})
		.controller("navbarController",function($scope,$http){
			$http({
				url:'http://localhost/healthCatogrey.php'
			}).then(function(res){
				//console.log(res.data)
				$scope.healthInformation=res.data.tngou;
				console.log(res.data.tngou)
			})

		})
		.controller('consurtListController',function($scope,$stateParams,$http){
			//alert(1)
			$http({
    			url:'http://localhost/healthList.php',
    			params:{
    				id:$stateParams.id,
    				page:$stateParams.page
    			}
    		}).then(function(res){
    			$scope.healthList= res.data.tngou;
    			//console.log($scope.healthList.id);
    			var pageCountList = [];
    			var rows = 12;

    			for(var i=1;i<=Math.ceil(res.data.total/rows); i++){
    				pageCountList.push(i);
    			}
    			$scope.id = $stateParams.id;
    			$scope.pageLCountist = pageCountList;


			
    		//$scope.sunPage=res.data.tngou
    		$scope.begin=0;
            //showPageAdd--->µã»÷ÏòÉÏ¹ö¶¯Ò³Âë
            $scope.showPageAdd=function(begin){
              if ($scope.begin>=res.data.total/rows-10) {
                return false;
              }
              $scope.begin++; 
            }
            //showPageDown--->µã»÷ÏòÏÂ¹ö¶¯Ò³Âë
            $scope.showPageDown=function(begin){
              if ($scope.begin<=0) {
                return false;
              }
              $scope.begin--;
            }


    		})
		})
		.controller('homeController',  function($scope){
			$scope.welocome='welcome';
		})
		.controller('healthDetailController',function($scope,$stateParams,$http,$sce){

    		$http({
    			url:'http://localhost/healthDetail.php',
    			params:{
    				id:$stateParams.id
    			}
    		}).then(function(res){
    			$scope.detail = res.data;
    			$scope.detailMessage=$sce.trustAsHtml($scope.detail.message)
    			console.log(res.data);
    		})
    	})
	</script>
</body>
</html>